<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Efigps - Control de Flota</title>
    <!-- Librería Leaflet para mapas -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Iconos Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Estilos principales de la aplicación -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div id="app-container">

        <!-- Carcasa del Dispositivo (Contenedor Principal) -->
        <div class="device-interface">

            <!-- Sección de Pantalla -->
            <div class="screen-frame">
                <div id="digital-screen" class="screen-content">
            <!-- Barra Superior: Estado (Nueva Estructura) -->
            <div class="top-bar">
                <span id="clock">12:00:00</span>
                <span id="speed">0 KM/H</span>
                <span id="lap-display">V:1</span>
                        <div class="status-icons">
                            <i class="fa-solid fa-satellite-dish"></i>
                            <i class="fa-solid fa-signal"></i>
                            <i class="fa-solid fa-battery-three-quarters"></i>
                        </div>
                    </div>

            <!-- Barra de Información de Línea/Conductor -->
            <div class="info-bar">
                <span id="info-string">---</span>
                <!-- Oculto visualmente pero manteniendo ID para compatibilidad -->
                <span id="route-name" style="display:none;">SIN BANDERA</span>
                    </div>

                    <!-- Pantalla Principal (Visualización de Desviación) -->
                    <div class="main-display">
                        <div id="deviation-display" class="neutral">00:00</div>
                    </div>

                    <!-- Capa de Mapa de Navegación (Oculto por defecto) -->
                    <div id="nav-map-container" class="hidden">
                        <div id="nav-map"></div>
                    </div>

                    <!-- Información Inferior (Próxima parada y hora de llegada) -->
                    <div class="footer-info">
                        <div class="next-stop">
                            <span class="label">Próxima:</span>
                            <span id="next-stop-name">---</span>
                        </div>
                        <div class="arrival-time">
                            <span id="arrival-time">--:--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Barra de Funciones Inferior (Botones Físicos del Dispositivo) -->
             <div class="bottom-bar">
                <button class="func-btn" id="btn-contrast" title="Alto Contraste">U+</button>
                <button class="func-btn" id="btn-map-toggle" title="Mapa">m</button>
                <button class="func-btn" title="Chofer" id="btn-route-editor"><i class="fa-solid fa-user"></i></button> <!-- Usado para el Editor de Rutas -->
                <button class="func-btn" title="Modo Profesional" id="btn-pro-mode">PRO</button>
                <button class="func-btn yellow" id="btn-down"><i class="fa-solid fa-arrow-down"></i></button>
                <button class="func-btn yellow" id="btn-up"><i class="fa-solid fa-arrow-up"></i></button>
             </div>

        </div>

        <!-- Controles de Simulación (Externos al dispositivo simulado) -->
        <div class="sim-controls">
            <h3>Modo Simulación</h3>
            <label>Progreso de Bandera:</label>
            <input type="range" id="sim-slider" min="0" max="100" value="0" disabled>
            <div class="sim-info">
                <span id="sim-status">Inactivo</span>
            </div>
            <button id="btn-start-sim">Iniciar Simulación</button>

            <!-- Interruptor de Modo Manual (Movido aquí) -->
            <div class="manual-control-container">
                 <div class="switch-container">
                    <label class="switch">
                        <input type="checkbox" id="mode-switch-input">
                        <span class="slider round"></span>
                    </label>
                    <span class="mode-label">M</span>
                </div>
            </div>
        </div>

    </div>

    <!-- Modal del Modo Profesional -->
    <div id="pro-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" id="close-pro-modal">&times;</span>
            <h2>Gestión de Líneas y Servicios</h2>

            <!-- Vista Lista de Líneas -->
            <div id="pro-lines-view">
                <button id="btn-create-line" class="btn-primary">Crear Nueva Línea</button>
                <ul id="lines-list" class="item-list"></ul>
            </div>

            <!-- Vista Editor de Línea -->
            <div id="pro-line-editor" class="hidden">
                <div class="form-group">
                    <label>Nombre de la Línea:</label>
                    <input type="text" id="line-name-input" placeholder="Ej: Línea 106">
                </div>
                <div class="form-group">
                    <label>Bandera de IDA:</label>
                    <select id="select-route-ida"></select>
                </div>
                <div class="form-group">
                    <label>Bandera de VUELTA:</label>
                    <select id="select-route-vuelta"></select>
                </div>

                <h3>Diagrama de Servicio</h3>
                <div class="diagram-grid">
                    <div class="form-group">
                        <label>Inicio Servicio:</label>
                        <input type="time" id="line-start-time">
                    </div>
                    <div class="form-group">
                        <label>Fin Servicio:</label>
                        <input type="time" id="line-end-time">
                    </div>
                    <div class="form-group">
                        <label>Vueltas:</label>
                        <input type="number" id="line-turns" step="0.5" min="0.5" placeholder="Ej: 4.5">
                    </div>
                    <div class="form-group">
                        <label>Espera Fin IDA (min):</label>
                        <input type="number" id="line-rest-ida" min="0" placeholder="Ej: 10">
                    </div>
                    <div class="form-group">
                        <label>Espera Fin VUELTA (min):</label>
                        <input type="number" id="line-rest-vuelta" min="0" placeholder="Ej: 10">
                    </div>
                </div>

                <div class="actions">
                    <button id="btn-save-line">Guardar Línea</button>
                    <button id="btn-cancel-line" class="btn-secondary">Cancelar</button>
                    <button id="btn-delete-line" class="btn-danger hidden">Eliminar</button>
                </div>
            </div>

            <!-- Vista Selección de Viaje (Driver) -->
            <div id="pro-driver-view" class="hidden">
                <button id="btn-back-lines" class="btn-small">Volver a Líneas</button>
                <h3 id="driver-line-title">Seleccionar Viaje</h3>
                <div id="trips-list" class="trips-grid"></div>
            </div>
        </div>
    </div>

    <!-- Modal del Editor de Rutas -->
    <div id="editor-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" id="close-editor-modal">&times;</span>
            <h2>Editor de Banderas</h2>

            <div class="editor-layout">
                <div class="map-column">
                    <div id="editor-map"></div>
                    <p class="hint">Toque el mapa para agregar paradas. Arrastre para mover.</p>
                </div>
                <div class="form-column">
                    <div class="form-group">
                        <label>Nombre de Bandera:</label>
                        <input type="text" id="route-name-input" placeholder="Ej: Línea 10 - Centro">
                    </div>

                    <div id="stops-list">
                        <!-- Las paradas se generan aquí dinámicamente -->
                    </div>

                    <div class="editor-actions">
                        <button id="btn-calc-times">Calcular Intermedios</button>
                        <button id="btn-save-route">Guardar Bandera</button>
                        <button id="btn-clear-route">Limpiar</button>
                    </div>

                    <h3>Banderas Guardadas</h3>
                    <ul id="saved-routes-list"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts de la aplicación -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/map_logic.js"></script>
    <script src="js/route_logic.js"></script>
    <script src="js/schedule_logic.js"></script>
    <script src="js/app.js"></script>

    <!-- Modal Login Chofer -->
    <div id="login-modal" class="modal hidden" style="z-index: 2000;">
        <div class="modal-content" style="max-width: 400px; height: auto; padding: 20px; overflow: visible;">
            <h2>Iniciar Sesión</h2>
            <div class="form-group">
                <label>Legajo (5 dígitos)</label>
                <input type="number" id="login-legajo" placeholder="Ej: 98538" maxlength="5">
            </div>
            <div class="form-group">
                <label>Número de Coche</label>
                <input type="text" id="login-coche" placeholder="Ej: 3222">
            </div>
            <div class="form-group">
                <label>Servicio</label>
                <input type="text" id="login-servicio" placeholder="Ej: 1">
            </div>
            <div class="form-group">
                <label>Tipo de Horario</label>
                <input type="text" id="login-horario" placeholder="Ej: HABILES">
            </div>
            <div class="actions" style="margin-top: 20px;">
                <button id="btn-login" class="btn-primary" style="width: 100%;">INGRESAR</button>
            </div>
        </div>
    </div>
</body>
</html>
